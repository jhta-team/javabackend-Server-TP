<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mybatis.example.BlogMapper">

	<select id="loginMember" parameterType="HashMap" resultType="MemberDto">
  		select * from member where userID= #{userID} and userPW = #{userPW}
  	</select>
  	<select id="imageMember" parameterType="int" resultType="String">
  		select profile from member where no=#{no}
  	</select>
  	<insert id="insertMember" parameterType="MemberDto" >
  		insert into member values(#{userID},#{userPW},#{userName},#{gender},
  		#{address},#{detailAddress},#{postCode},#{email},#{mobileTelcom},#{tel},
  		#{profile},#{nickName},sysdate,seq_member.nextval,0) 
  	</insert>
  	<select id="insertCount" resultType="int">
  		select count(*) count from member where TO_DATE(redate,'YYYY-mm-dd') =TO_DATE(sysdate,'YYYY-mm-dd') 
  	</select>
  	<select id="memberCount" resultType="int">
  		select count(no) count from member 
  	</select>
  	<select id="noBlackMemberCount" resultType="int">
  		select count(no) count from member where adminNumber <![CDATA[<=]]> 5
  	</select>
  	<select id="blackMemberCount" resultType="int">
  		select count(no) count from member where adminNumber = 6
  	</select>
  	<select id="idCheck" parameterType="String" resultType="int">
  		select count(no) as count from member where userID=#{userID}
  	</select>
  	
  	<select id="nickNameCheck" parameterType="String" resultType="int">
  		select count(no) as count from member where nickName=#{nickName}
  	</select>
  	<select id="infoMember" parameterType="String" resultType="MemberDto">
  		select * from member where userID=#{userID}
  	</select>
  	<select id="passwordBlur" parameterType="String" resultType="String">
  		SELECT RPAD(REPLACE (SUBSTR(USERPW ,1,1),SUBSTR(USERPW ,1,1),'*'),LENGTH(USERPW),'*') AS PASSWORD FROM MEMBER WHERE  userID=#{userID}
  	</select>
  	<select id="infoModify" parameterType="HashMap" resultType="MemberDto">
  		select * from member where userID= #{userID} and userPW = #{userPW}
  	</select>
  	<update id="infoUpdateMember" parameterType="MemberDto">
  		update member set nickName = #{nickName}, postCode = #{postCode},address=#{address}, detailAddress=#{detailAddress},email=#{email},
  		tel=#{tel}, profile=#{profile}, userName=#{userName},mobileTelcom=#{mobileTelcom} where userID=#{userID}
  	</update>
  	<delete id="deleteMember" parameterType="HashMap">
  		delete from member where userID = #{userID} and userPW = #{userPW}
  	</delete>
  	<select id="listMember" parameterType="HashMap" resultType="MemberDto">
  			SELECT userID, userPW, userName, nickName, address, postCode, tel, email, redate, adminNumber,no FROM 
			(SELECT  ROW_NUMBER() over(ORDER BY r.NO desc) as num , userID, userPW, userName, nickName, address, postCode, tel, email, redate, adminNumber,no 
			FROM MEMBER r WHERE adminNumber <![CDATA[<=]]> 5)r 
			WHERE num <![CDATA[>=]]> #{start} AND num <![CDATA[<=]]> #{end}
  	</select>
  	<update id="blackUpdate" parameterType="HashMap">
  		update member set adminNumber = #{adminNumber} where no = #{no}
  	</update>
  	<update id="blackUpdateAll" parameterType="HashMap">
  		update member set adminNumber = #{adminNumber} where no = #{no}
  	</update>
  	<select id="blackListMember" parameterType="HashMap" resultType="MemberDto">
  		SELECT  userID, userPW, userName, nickName, address, postCode, tel, email, redate, adminNumber,no  FROM (SELECT rownum AS num, r.* FROM (SELECT *FROM  MEMBER where adminNumber = 6 ORDER BY no DESC)r)
  		where num  <![CDATA[>=]]> #{start} and num  <![CDATA[<=]]> #{end} 
  	</select>
  	<delete id="deleteAdminMember" parameterType="int">
  		delete from member where no = #{no} 
  	</delete>
  	<select id="idCheckDelete" parameterType="int" resultType="String">
  		select userID from member where no = #{no} 	
  	</select>
  	<select id="searhMember" parameterType="HashMap" resultType="MemberDto">
  		SELECT  userID, userPW, userName, nickName, address, postCode, tel, email, redate, adminNumber,no  FROM (SELECT rownum AS num, r.* FROM (SELECT *FROM  MEMBER where adminNumber <![CDATA[<=]]> 5 and 
  		<choose>
  		<when test="search=='userName'">
  			userName Like '%'||#{searchword}||'%'  
  		</when>
  		<when test="search=='nickName'">
  			nickName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='userID'">
  			userID Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='level'">
  			adminNumber Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='all'">
  			(adminNumber Like '%'||#{searchword}||'%') or
  			(userID Like '%'||#{searchword}||'%') or
  			(nickName Like '%'||#{searchword}||'%') or
  			(userName Like '%'||#{searchword}||'%')  
  		</when>
  		</choose>
  		 ORDER BY no DESC)r) where  num  <![CDATA[>=]]> #{start} and num  <![CDATA[<=]]> #{end}
  	</select>
  	
  	 <select id="searhMemberCount" parameterType="HashMap"  resultType="int">
  		SELECT  count(*) as count  FROM MEMBER where adminNumber <![CDATA[<=]]> 5 and
  		<choose>
  		<when test="search=='userName'">
  			userName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='nickName'">
  			nickName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='userID'">
  			userID Like '%'||#{searchword}||'%'
  		</when>
  		<when test="search=='level'">
  			adminNumber Like '%'||#{searchword}||'%'
  		</when>
  		<when test="search=='all'">
  			(adminNumber Like '%'||#{searchword}||'%') or
  			(userID Like '%'||#{searchword}||'%') or
  			(nickName Like '%'||#{searchword}||'%') or
  			(userName Like '%'||#{searchword}||'%') 
  		</when>
  		</choose>
  	</select>
  	
  	  	<select id="blackSearhMember" parameterType="HashMap" resultType="MemberDto">
  		SELECT  userID, userPW, userName, nickName, address, postCode, tel, email, redate, adminNumber,no  FROM (SELECT rownum AS num, r.* FROM (SELECT *FROM  MEMBER where adminNumber <![CDATA[=]]> 6 and 
  		<choose>
  		<when test="search=='userName'">
  			userName Like '%'||#{searchword}||'%'  
  		</when>
  		<when test="search=='nickName'">
  			nickName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='userID'">
  			userID Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='all'">
  			(userID Like '%'||#{searchword}||'%') or
  			(nickName Like '%'||#{searchword}||'%') or
  			(userName Like '%'||#{searchword}||'%')  
  		</when>
  		</choose>
  		 ORDER BY no DESC)r) where  num  <![CDATA[>=]]> #{start} and num  <![CDATA[<=]]> #{end}
  	</select>
  	 <select id="blackSearhMemberCount" parameterType="HashMap"  resultType="int">
  		SELECT  count(*) as count FROM Member where adminNumber = 6 and
  		<choose>
  		<when test="search=='userName'">
  			userName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='nickName'">
  			nickName Like '%'||#{searchword}||'%' 
  		</when>
  		<when test="search=='userID'">
  			userID Like '%'||#{searchword}||'%'
  		</when>
  		<when test="search=='all'">
  			(userID Like '%'||#{searchword}||'%') or
  			(nickName Like '%'||#{searchword}||'%') or
  			(userName Like '%'||#{searchword}||'%') 
  		</when>
  		
  		</choose>
  	</select>
  	<select id="findID" parameterType="HashMap" resultType="String">
  		select userID from member where userName = #{userName} and email = #{email}
  	</select>
  	<update id="findPWChange" parameterType="HashMap">
  		update member set userPW = #{userPW} where userID=#{userID} and userName = #{userName} and email = #{email}
  	</update>
</mapper>